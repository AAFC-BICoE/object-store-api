version: "3.7"

services:
  object-store-db:
    image: "postgres:12"
    env_file:
      - ${BASE_PATH_TO_OBJECT_STORE:-.}/pg.env
    volumes:
      - ${BASE_PATH_TO_OBJECT_STORE:-.}/src/test/resources/create-test-users.sql:/docker-entrypoint-initdb.d/1-init-schema.sql

  versitygw:
    image: versity/versitygw:latest
    container_name: versitygw
    # The command tells Versity to use the 'posix' backend
    command: posix /data
    environment:
      # S3 Credentials
      - ROOT_ACCESS_KEY=myaccesskey
      - ROOT_SECRET_KEY=mysecretkey
      - VGW_HEALTH=/health
      - VGW_REGION=none
    ports:
      - "7070:7070"
    volumes:
      # Map your host folder to the container
      - ./versity_data:/data

  object-store-api:
    image: aafcbicoe/object-store-api:0.40
    # build: ${BASE_PATH_TO_OBJECT_STORE:-.}
    ports:
      - "8081:8080"
    env_file:
      - ${BASE_PATH_TO_OBJECT_STORE:-.}/object-store-api.env
    networks:
      default:
